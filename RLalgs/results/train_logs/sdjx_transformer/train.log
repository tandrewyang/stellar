/root/miniconda3/envs/py310_sc2/lib/python3.10/site-packages/sacred/dependencies.py:11: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
  import pkg_resources
[DEBUG 16:09:24] git.cmd Popen(['git', 'version'], cwd=/share/project/ytz/RLproject/StarCraft2_HLSMAC/RLalgs/TransformerMixer, stdin=None, shell=False, universal_newlines=False)
[DEBUG 16:09:24] git.cmd Popen(['git', 'version'], cwd=/share/project/ytz/RLproject/StarCraft2_HLSMAC/RLalgs/TransformerMixer, stdin=None, shell=False, universal_newlines=False)
[DEBUG 16:09:24] git.util sys.platform='linux', git_executable='git'
[DEBUG 16:09:24] git.cmd Popen(['git', 'diff', '--cached', '--abbrev=40', '--full-index', '--raw'], cwd=/share/project/ytz/RLproject/StarCraft2_HLSMAC, stdin=None, shell=False, universal_newlines=False)
[DEBUG 16:09:24] git.cmd Popen(['git', 'diff', '--abbrev=40', '--full-index', '--raw'], cwd=/share/project/ytz/RLproject/StarCraft2_HLSMAC, stdin=None, shell=False, universal_newlines=False)
[DEBUG 16:09:24] git.cmd Popen(['git', 'cat-file', '--batch-check'], cwd=/share/project/ytz/RLproject/StarCraft2_HLSMAC, stdin=<valid stream>, shell=False, universal_newlines=False)
[DEBUG 16:09:24] git.util sys.platform='linux', git_executable='git'
[DEBUG 16:09:24] git.cmd Popen(['git', 'diff', '--cached', '--abbrev=40', '--full-index', '--raw'], cwd=/share/project/ytz/RLproject/StarCraft2_HLSMAC, stdin=None, shell=False, universal_newlines=False)
[DEBUG 16:09:24] git.cmd Popen(['git', 'diff', '--abbrev=40', '--full-index', '--raw'], cwd=/share/project/ytz/RLproject/StarCraft2_HLSMAC, stdin=None, shell=False, universal_newlines=False)
[DEBUG 16:09:24] git.cmd Popen(['git', 'cat-file', '--batch-check'], cwd=/share/project/ytz/RLproject/StarCraft2_HLSMAC, stdin=<valid stream>, shell=False, universal_newlines=False)
[INFO 16:09:24] root Saving to FileStorageObserver in /share/project/ytz/RLproject/StarCraft2_HLSMAC/RLalgs/TransformerMixer/results/sacred/sdjx/transformer_qmix_env=4_adam_td_lambda.
[DEBUG 16:09:26] pymarl Using capture mode "fd"
[INFO 16:09:26] pymarl Running command 'my_main'
[INFO 16:09:26] pymarl Started run with ID "17"
[DEBUG 16:09:26] pymarl Starting Heartbeat
[DEBUG 16:09:26] my_main Started
[INFO 16:09:26] my_main Experiment Parameters:
[INFO 16:09:26] my_main 

{   'action_selector': 'epsilon_greedy',
    'agent': 'rnn',
    'agent_output_type': 'q',
    'alpha_init': -0.07,
    'alpha_lr': '3e-4',
    'batch_size': 128,
    'batch_size_run': 1,
    'buffer_cpu_only': True,
    'buffer_size': 5000,
    'c_beta': 1.0,
    'central_action_embed': 1,
    'central_agent': 'central_rnn',
    'central_loss': 1,
    'central_mac': 'basic_central_mac',
    'central_mixer': 'ff',
    'central_mixing_embed_dim': 256,
    'central_rnn_hidden_dim': 64,
    'checkpoint_path': '',
    'comm': True,
    'comm_beta': 0.001,
    'comm_beta_end_decay': 50000000,
    'comm_beta_start_decay': 20000000,
    'comm_beta_target': '1e-2',
    'comm_embed_dim': 3,
    'comm_entropy_beta': '1e-6',
    'comm_entropy_beta_end_decay': 50000000,
    'comm_entropy_beta_start_decay': 20000000,
    'comm_entropy_beta_target': '1e-4',
    'comm_method': 'information_bottleneck_full',
    'critic_agent': 'rnn_agent_n',
    'critic_lr': 0.0005,
    'critic_mac': 'cate_broadcast_comm_mac_full',
    'cut_mu_rank_thres': 80.0,
    'cut_mu_thres': 1.0,
    'double_q': True,
    'env': 'sc2_tactics',
    'env_args': {   'continuing_episode': False,
                    'debug': False,
                    'difficulty': '7',
                    'game_version': None,
                    'heuristic_ai': False,
                    'heuristic_rest': False,
                    'map_name': 'sdjx',
                    'move_amount': 2,
                    'obs_all_health': True,
                    'obs_instead_of_state': False,
                    'obs_last_action': False,
                    'obs_own_health': True,
                    'obs_pathing_grid': True,
                    'obs_terrain_height': True,
                    'obs_timestep_number': False,
                    'replay_dir': '',
                    'replay_prefix': '',
                    'reward_death_value': 10,
                    'reward_defeat': 0,
                    'reward_negative_scale': 0.5,
                    'reward_only_positive': False,
                    'reward_scale': True,
                    'reward_scale_rate': 20,
                    'reward_sparse': False,
                    'reward_win': 200,
                    'seed': 42,
                    'state_last_action': True,
                    'state_timestep_number': False,
                    'step_mul': 8},
    'epsilon_anneal_time': 100000,
    'epsilon_finish': 0.05,
    'epsilon_start': 0.995,
    'evaluate': False,
    'gamma': 0.99,
    'gate_loss_beta': 1e-05,
    'grad_norm_clip': 10,
    'hysteretic_qmix': True,
    'is_comm_beta_decay': False,
    'is_comm_entropy_beta_decay': False,
    'is_cur_mu': False,
    'is_print': False,
    'is_rank_cut_mu': False,
    'label': 'default_label',
    'learner': 'max_q_learner',
    'learner_log_interval': 10000,
    'load_step': 0,
    'local_results_path': 'results',
    'log_interval': 10000,
    'lr': 0.001,
    'mac': 'basic_mac_logits',
    'mixer': 'transformer_qmix',
    'mixing_embed_dim': 32,
    'name': 'transformer_qmix_env=4_adam_td_lambda',
    'obs_agent_id': True,
    'obs_last_action': True,
    'only_downstream': False,
    'optim_alpha': 0.99,
    'optim_eps': 1e-05,
    'p': 0.5,
    'qmix_loss': 1,
    'repeat_id': 1,
    'rnn_hidden_dim': 64,
    'run': 'default',
    'runner': 'episode',
    'runner_log_interval': 10000,
    'save_model': True,
    'save_model_interval': 500000,
    'save_replay': False,
    'seed': 42,
    't_max': 2005000,
    'target_update_interval': 200,
    'td_lambda': 0.6,
    'test_greedy': True,
    'test_interval': 10000,
    'test_nepisode': 32,
    'transformer_dropout': 0.1,
    'transformer_ff_dim': 128,
    'transformer_heads': 2,
    'transformer_layers': 1,
    'use_IB': True,
    'use_cuda': True,
    'use_tensorboard': False,
    'w': 0.5}

----------------------
You create a SDJX env!
----------------------
514
Mixer Size: 
569.924K
namespace(runner='episode', mac='basic_mac_logits', env='sc2_tactics', env_args={'continuing_episode': False, 'difficulty': '7', 'game_version': None, 'map_name': 'sdjx', 'move_amount': 2, 'obs_all_health': True, 'obs_instead_of_state': False, 'obs_last_action': False, 'obs_own_health': True, 'obs_pathing_grid': True, 'obs_terrain_height': True, 'obs_timestep_number': False, 'reward_death_value': 10, 'reward_defeat': 0, 'reward_negative_scale': 0.5, 'reward_only_positive': False, 'reward_scale': True, 'reward_scale_rate': 20, 'reward_sparse': False, 'reward_win': 200, 'replay_dir': '', 'replay_prefix': '', 'state_last_action': True, 'state_timestep_number': False, 'step_mul': 8, 'seed': 42, 'heuristic_ai': False, 'heuristic_rest': False, 'debug': False}, batch_size_run=1, test_nepisode=32, test_interval=10000, test_greedy=True, log_interval=10000, runner_log_interval=10000, learner_log_interval=10000, t_max=2005000, use_cuda=True, buffer_cpu_only=True, use_tensorboard=False, save_model=True, save_model_interval=500000, checkpoint_path='', evaluate=False, load_step=0, save_replay=False, local_results_path='results', gamma=0.99, batch_size=128, buffer_size=5000, lr=0.001, critic_lr=0.0005, optim_alpha=0.99, optim_eps=1e-05, grad_norm_clip=10, agent='rnn', rnn_hidden_dim=64, obs_agent_id=True, obs_last_action=True, repeat_id=1, label='default_label', run='default', action_selector='epsilon_greedy', epsilon_start=0.995, epsilon_finish=0.05, epsilon_anneal_time=100000, critic_mac='cate_broadcast_comm_mac_full', critic_agent='rnn_agent_n', comm=True, comm_embed_dim=3, comm_method='information_bottleneck_full', c_beta=1.0, comm_beta=0.001, comm_entropy_beta='1e-6', gate_loss_beta=1e-05, only_downstream=False, use_IB=True, is_print=False, is_comm_beta_decay=False, comm_beta_start_decay=20000000, comm_beta_target='1e-2', comm_beta_end_decay=50000000, is_comm_entropy_beta_decay=False, comm_entropy_beta_start_decay=20000000, comm_entropy_beta_target='1e-4', comm_entropy_beta_end_decay=50000000, is_cur_mu=False, is_rank_cut_mu=False, cut_mu_thres=1.0, cut_mu_rank_thres=80.0, target_update_interval=200, agent_output_type='q', learner='max_q_learner', double_q=True, mixer='transformer_qmix', mixing_embed_dim=32, transformer_heads=2, transformer_layers=1, transformer_ff_dim=128, transformer_dropout=0.1, central_loss=1, qmix_loss=1, w=0.5, hysteretic_qmix=True, central_mixing_embed_dim=256, central_action_embed=1, central_mac='basic_central_mac', central_agent='central_rnn', central_rnn_hidden_dim=64, central_mixer='ff', td_lambda=0.6, alpha_lr='3e-4', alpha_init=-0.07, p=0.5, name='transformer_qmix_env=4_adam_td_lambda', seed=42, device='cuda', unique_token='transformer_qmix_env=4_adam_td_lambda__2025-11-26_16-09-26', n_agents=18, n_actions=23, state_shape=764, accumulated_episodes=None)
[INFO 16:09:28] my_main Beginning training for 2005000 timesteps
[INFO 16:09:28] absl Launching SC2: /share/project/ytz/StarCraftII/Versions/Base75689/SC2_x64 -listen 127.0.0.1 -port 44663 -dataDir /share/project/ytz/StarCraftII/ -tempDir /tmp/sc-76iqoglc/
[INFO 16:09:28] absl Connecting to: ws://127.0.0.1:44663/sc2api, attempt: 0, running: True
Version: B75689 (SC2.4.10)
Build: Aug 12 2019 17:16:57
Command Line: '"/share/project/ytz/StarCraftII/Versions/Base75689/SC2_x64" -listen 127.0.0.1 -port 44663 -dataDir /share/project/ytz/StarCraftII/ -tempDir /tmp/sc-76iqoglc/'
Starting up...
Startup Phase 1 complete
[INFO 16:09:29] absl Connecting to: ws://127.0.0.1:44663/sc2api, attempt: 1, running: True
Startup Phase 2 complete
Creating stub renderer...
Listening on: 127.0.0.1:44663
Startup Phase 3 complete. Ready for commands.
[INFO 16:09:30] absl Connecting to: ws://127.0.0.1:44663/sc2api, attempt: 2, running: True
ConnectHandler: Request from 127.0.0.1:34200 accepted
ReadyHandler: 127.0.0.1:34200 ready
Requesting to join a single player game
Configuring interface options
Configure: raw interface enabled
Configure: feature layer interface disabled
Configure: score interface disabled
Configure: render interface disabled
Launching next game.
Next launch phase started: 2
Next launch phase started: 3
Next launch phase started: 4
Next launch phase started: 5
Next launch phase started: 6
Next launch phase started: 7
Next launch phase started: 8
Game has started.
Using default stable ids, none found at: /share/project/ytz/StarCraftII/stableid.json
Successfully loaded stable ids: GameData\stableid.json
Sending ResponseJoinGame
{'marine': 48, 'medivac': 54}
/share/project/ytz/RLproject/StarCraft2_HLSMAC/RLalgs/TransformerMixer/src/components/episode_buffer.py:103: UserWarning: Creating a tensor from a list of numpy.ndarrays is extremely slow. Please consider converting the list to a single numpy.ndarray with numpy.array() before converting to a tensor. (Triggered internally at ../torch/csrc/utils/tensor_new.cpp:261.)
  v = th.tensor(v, dtype=dtype, device=self.device)
/share/project/ytz/RLproject/StarCraft2_HLSMAC/RLalgs/TransformerMixer/src/components/episode_buffer.py:103: UserWarning: To copy construct from a tensor, it is recommended to use sourceTensor.clone().detach() or sourceTensor.clone().detach().requires_grad_(True), rather than torch.tensor(sourceTensor).
  v = th.tensor(v, dtype=dtype, device=self.device)
[INFO 16:09:38] my_main t_env: 150 / 2005000
[INFO 16:09:38] my_main Estimated time left: 30 minutes, 24 seconds. Time passed: 9 seconds
[INFO 16:10:54] my_main Saving models to results/models/transformer_qmix_env=4_adam_td_lambda__2025-11-26_16-09-26/150
[INFO 16:13:59] my_main Recent Stats | t_env:      10132 | Episode:       70
battle_won_mean:           0.0000	dead_allies_mean:         11.0000	dead_enemies_mean:         1.0000	delta_ally_mean:         247.5000
delta_deaths_mean:       -45.0000	delta_enemy_mean:        150.0000	ep_length_mean:          150.0000	epsilon:                   0.9950
reward_mean:              -0.3389	reward_std:                0.0000	test_battle_won_mean:      0.0000	test_dead_allies_mean:     0.0000
test_dead_enemies_mean:    0.0000	test_delta_ally_mean:      0.0000	test_delta_deaths_mean:    0.0000	test_delta_enemy_mean:     0.0000
test_ep_length_mean:     150.0000	test_reward_mean:          0.0000	test_reward_std:           0.0000	
[INFO 16:14:02] my_main t_env: 10282 / 2005000
[INFO 16:14:02] my_main Estimated time left: 14 hours, 28 minutes, 13 seconds. Time passed: 4 minutes, 33 seconds
[INFO 16:26:38] my_main Recent Stats | t_env:      20182 | Episode:      137
alpha:                     0.9323	alpha_loss:              -30.5015	battle_won_mean:           0.0000	central_loss:              0.0011
comm_loss:                 0.5653	dead_allies_mean:          9.3143	dead_enemies_mean:         0.1857	delta_ally_mean:         236.8172
delta_deaths_mean:       -44.7143	delta_enemy_mean:         46.4929	ep_length_mean:          144.7429	epsilon:                   0.8993
grad_norm:                 1.3398	loss:                      0.6653	mixer_norm:                1.3300	policy_loss:               0.2044
q_taken_mean:              0.0107	qmix_loss:                 0.0989	reward_mean:              -0.5590	reward_std:                0.2208
target_mean:              -0.0138	td_error_abs:              0.4419	test_battle_won_mean:      0.0000	test_dead_allies_mean:     0.0000
test_dead_enemies_mean:    0.0000	test_delta_ally_mean:      0.0000	test_delta_deaths_mean:    0.0000	test_delta_enemy_mean:     0.0000
test_ep_length_mean:     150.0000	test_reward_mean:          0.0000	test_reward_std:           0.0000	w_to_use:                  0.5000

[INFO 16:27:16] my_main t_env: 20332 / 2005000
[INFO 16:27:16] my_main Estimated time left: 1 days, 19 hours, 32 minutes, 50 seconds. Time passed: 17 minutes, 47 seconds
[INFO 17:01:58] my_main Updated target network
[INFO 17:51:54] my_main Recent Stats | t_env:      30206 | Episode:      330
alpha:                     0.9171	alpha_loss:              -29.1189	battle_won_mean:           0.0000	central_loss:              0.0005
comm_loss:                 0.0062	dead_allies_mean:          4.1642	dead_enemies_mean:         0.0896	delta_ally_mean:         101.6379
delta_deaths_mean:       -19.9254	delta_enemy_mean:         14.7463	ep_length_mean:          150.0000	epsilon:                   0.8043
grad_norm:                 0.0089	loss:                      0.0077	mixer_norm:                0.0052	policy_loss:              -0.2254
q_taken_mean:             -0.0137	qmix_loss:                 0.0010	reward_mean:              -0.2540	reward_std:                0.1944
target_mean:              -0.0141	td_error_abs:              0.0229	test_battle_won_mean:      0.0000	test_dead_allies_mean:     0.0000
test_dead_enemies_mean:    0.0000	test_delta_ally_mean:      0.0000	test_delta_deaths_mean:    0.0000	test_delta_enemy_mean:     0.0000
test_ep_length_mean:     150.0000	test_reward_mean:          0.0000	test_reward_std:           0.0000	w_to_use:                  0.7787

[INFO 17:53:34] my_main t_env: 30389 / 2005000
[INFO 17:53:34] my_main Estimated time left: 11 days, 18 hours, 22 minutes, 47 seconds. Time passed: 1 hours, 44 minutes, 5 seconds
[INFO 18:18:38] my_main Updated target network
[INFO 19:33:06] my_main Updated target network
[INFO 19:35:07] my_main Recent Stats | t_env:      40206 | Episode:      606
alpha:                     0.8924	alpha_loss:              -29.1442	battle_won_mean:           0.0000	central_loss:              0.0003
comm_loss:                 0.0041	dead_allies_mean:         14.0561	dead_enemies_mean:         0.0051	delta_ally_mean:         400.2135
delta_deaths_mean:       -70.2296	delta_enemy_mean:        118.6747	ep_length_mean:           51.3112	epsilon:                   0.7087
grad_norm:                 0.0081	loss:                      0.0052	mixer_norm:                0.0062	policy_loss:              -0.1163
q_taken_mean:             -0.0150	qmix_loss:                 0.0008	reward_mean:              -0.8365	reward_std:                0.2977
target_mean:              -0.0154	td_error_abs:              0.0223	test_battle_won_mean:      0.0000	test_dead_allies_mean:    14.0000
test_dead_enemies_mean:    0.0000	test_delta_ally_mean:    366.5312	test_delta_deaths_mean:  -70.0000	test_delta_enemy_mean:     0.0000
test_ep_length_mean:      18.1562	test_reward_mean:         -1.0381	test_reward_std:           0.0290	w_to_use:                  0.8579

[INFO 19:37:39] my_main t_env: 40402 / 2005000
[INFO 19:37:39] my_main Estimated time left: 14 days, 4 hours, 24 minutes, 36 seconds. Time passed: 3 hours, 28 minutes, 11 seconds
[INFO 20:41:35] my_main Updated target network
RequestQuit command received.
Closing Application...
DataHandler: unable to parse websocket frame.
CloseHandler: 127.0.0.1:34200 disconnected
[INFO 21:05:50] absl Shutdown gracefully.
[INFO 21:05:50] absl Shutdown with return code: -15
[INFO 21:05:50] absl Launching SC2: /share/project/ytz/StarCraftII/Versions/Base75689/SC2_x64 -listen 127.0.0.1 -port 38437 -dataDir /share/project/ytz/StarCraftII/ -tempDir /tmp/sc-2lrbk03c/
[INFO 21:05:50] absl Connecting to: ws://127.0.0.1:38437/sc2api, attempt: 0, running: True
Version: B75689 (SC2.4.10)
Build: Aug 12 2019 17:16:57
Command Line: '"/share/project/ytz/StarCraftII/Versions/Base75689/SC2_x64" -listen 127.0.0.1 -port 38437 -dataDir /share/project/ytz/StarCraftII/ -tempDir /tmp/sc-2lrbk03c/'
Starting up...
Startup Phase 1 complete
[INFO 21:05:51] absl Connecting to: ws://127.0.0.1:38437/sc2api, attempt: 1, running: True
[INFO 21:05:52] absl Connecting to: ws://127.0.0.1:38437/sc2api, attempt: 2, running: True
Startup Phase 2 complete
Creating stub renderer...
[INFO 21:05:53] absl Connecting to: ws://127.0.0.1:38437/sc2api, attempt: 3, running: True
Listening on: 127.0.0.1:38437
Startup Phase 3 complete. Ready for commands.
[INFO 21:05:54] absl Connecting to: ws://127.0.0.1:38437/sc2api, attempt: 4, running: True
ConnectHandler: Request from 127.0.0.1:33138 accepted
ReadyHandler: 127.0.0.1:33138 ready
Requesting to join a single player game
Configuring interface options
Configure: raw interface enabled
Configure: feature layer interface disabled
Configure: score interface disabled
Configure: render interface disabled
Launching next game.
Next launch phase started: 2
Next launch phase started: 3
Next launch phase started: 4
Next launch phase started: 5
Next launch phase started: 6
Next launch phase started: 7
Next launch phase started: 8
Game has started.
Using default stable ids, none found at: /share/project/ytz/StarCraftII/stableid.json
Successfully loaded stable ids: GameData\stableid.json
Sending ResponseJoinGame
[INFO 21:14:46] my_main Recent Stats | t_env:      50216 | Episode:      901
alpha:                     0.8669	alpha_loss:              -29.1630	battle_won_mean:           0.0000	central_loss:              0.0004
comm_loss:                 0.0009	dead_allies_mean:         15.0717	dead_enemies_mean:         0.0000	delta_ally_mean:         430.6934
delta_deaths_mean:       -75.3584	delta_enemy_mean:        132.4001	ep_length_mean:           35.8889	epsilon:                   0.6135
grad_norm:                 0.0793	loss:                      0.0022	mixer_norm:                0.0762	policy_loss:              -0.1033
q_taken_mean:             -0.0167	qmix_loss:                 0.0009	reward_mean:              -0.8886	reward_std:                0.1673
target_mean:              -0.0181	td_error_abs:              0.0329	test_battle_won_mean:      0.0000	test_dead_allies_mean:    14.0000
test_dead_enemies_mean:    0.0000	test_delta_ally_mean:    362.8125	test_delta_deaths_mean:  -70.0000	test_delta_enemy_mean:     0.0000
test_ep_length_mean:      18.2500	test_reward_mean:         -1.0293	test_reward_std:           0.0261	w_to_use:                  0.8234

[INFO 21:15:50] my_main t_env: 50425 / 2005000
[INFO 21:15:50] my_main Estimated time left: 13 days, 7 hours, 5 minutes, 25 seconds. Time passed: 5 hours, 6 minutes, 21 seconds
/root/miniconda3/envs/py310_sc2/lib/python3.10/site-packages/sacred/stdout_capturing.py:179: UserWarning: tee_stdout.wait timeout. Forcibly terminating.
  warnings.warn("tee_stdout.wait timeout. Forcibly terminating.")
/root/miniconda3/envs/py310_sc2/lib/python3.10/site-packages/sacred/stdout_capturing.py:185: UserWarning: tee_stderr.wait timeout. Forcibly terminating.
  warnings.warn("tee_stderr.wait timeout. Forcibly terminating.")
[DEBUG 21:24:05] pymarl Stopping Heartbeat
[ERROR 21:24:05] pymarl Failed after 5:14:39!
Traceback (most recent calls WITHOUT Sacred internals):
  File "/share/project/ytz/RLproject/StarCraft2_HLSMAC/RLalgs/TransformerMixer/src/main.py", line 53, in my_main
    run_REGISTRY[_config['run']](_run, config, _log)
  File "/share/project/ytz/RLproject/StarCraft2_HLSMAC/RLalgs/TransformerMixer/src/run/run.py", line 54, in run
    run_sequential(args=args, logger=logger)
  File "/share/project/ytz/RLproject/StarCraft2_HLSMAC/RLalgs/TransformerMixer/src/run/run.py", line 197, in run_sequential
    learner.train(episode_sample, runner.t_env, episode)
  File "/share/project/ytz/RLproject/StarCraft2_HLSMAC/RLalgs/TransformerMixer/src/learners/max_q_learner.py", line 339, in train
    loss.backward(retain_graph=True)
  File "/root/miniconda3/envs/py310_sc2/lib/python3.10/site-packages/torch/_tensor.py", line 492, in backward
    torch.autograd.backward(
  File "/root/miniconda3/envs/py310_sc2/lib/python3.10/site-packages/torch/autograd/__init__.py", line 251, in backward
    Variable._execution_engine.run_backward(  # Calls into the C++ engine to run the backward pass
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 170.00 MiB. GPU 0 has a total capacty of 79.11 GiB of which 133.81 MiB is free. Process 2477363 has 6.53 GiB memory in use. Process 2481923 has 39.29 GiB memory in use. Process 2490711 has 33.14 GiB memory in use. Of the allocated memory 31.81 GiB is allocated by PyTorch, and 235.95 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF

[INFO 21:24:05] absl Shutdown gracefully.
[INFO 21:24:05] absl Shutdown with return code: -15
